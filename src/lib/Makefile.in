SOURCES_C=prym_green.c
SOURCES_CXX=submatrix.cc
HEADERS=prym_green_types.h
HEADERS+=$(SOURCES_C:.c=.h) $(SOURCES_CXX:.cc=.h)
OBJECTS=$(SOURCES_C:.c=.o) $(SOURCES_CXX:.cc=.o)
LIBNAME=libprymgreen.so

INCLUDE_FLINT=-I$(FLINT_DIR)/include
INCLUDE_SINGULAR=-I$(SINGULAR_DIR)/include -I$(SINGULAR_DIR)/include/singular

LINKING_OPTIONS=-Wl,-rpath,$(FLINT_DIR)/lib,-rpath,$(SINGULAR_DIR)/lib
LINKING_OPTIONS+=-L$(FLINT_DIR)/lib -L$(SINGULAR_DIR)/lib -lflint

all: $(LIBNAME)

prym_green.o: prym_green.c
	@echo "  CC      $@"
	$(Q)$(CC) -c $(CFLAGS) $(INCLUDE_FLINT) -o$@ $<

submatrix.o: submatrix.cc
	@echo "  CXX     $@"
	$(Q)$(CXX) -c $(CXXFLAGS) $(INCLUDE_SINGULAR) -o$@ $<

$(LIBNAME): $(OBJECTS)
	@echo "  CCLD    $@"
	$(Q)$(CC) -shared -fPIC $(LINKING_OPTIONS) -o$(LIBNAME) $(OBJECTS)

install: $(LIBNAME)
	$(Q)mkdir -p $(PREFIX)/include
	$(Q)mkdir -p $(PREFIX)/lib
	@echo "  CP      $(HEADERS)"
	$(Q)cp $(HEADERS) $(PREFIX)/include
	@echo "  CP      $(LIBNAME)"
	$(Q)cp $(LIBNAME) $(PREFIX)/lib

clean:
	@echo "  RM      $(OBJECTS)"
	$(Q)rm -f $(OBJECTS)
	@echo "  RM      $(LIBNAME)"
	$(Q)rm -f $(LIBNAME)

.PHONY: clean
