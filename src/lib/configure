#!/bin/sh

FLINT_DIR=/usr/local
SINGULAR_DIR=/usr/local

absolute_path() {
    dirlist="$1"
    retval=""
    for dir in $dirlist; do
        case $dir in
            /*) dir=$dir;;
            *) dir=$PWD/$dir;;
        esac
        retval=$retval" "$dir
    done
    echo $retval
}

while [ "$1" != "" ]; do
    PARAM=`echo $1 | sed 's/=.*//'`
    VALUE=`echo $1 | sed 's/[^=]*//; s/=//'`
    case "$PARAM" in
        --prefix)
            PREFIX="$VALUE"
            ;;
        --with-flint)
            FLINT_DIR=$(absolute_path "$VALUE")
            ;;
        --with-singular)
            SINGULAR_DIR=$(absolute_path "$VALUE")
            ;;
        CC)
            CC="$VALUE"
            ;;
        CFLAGS)
            CFLAGS="$VALUE"
            ;;
        CXX)
            CXX="$VALUE"
            ;;
        CXXFLAGS)
            CXXFLAGS="$VALUE"
            ;;
    esac
    shift
done

if [ -z "$CC" ]; then
    CC=gcc
fi

if [ -z "$CFLAGS" ]; then
    CFLAGS="-fPIC -Wall"
fi

if [ -z "$CXX" ]; then
    CXX=g++
fi

if [ -z "$CXXFLAGS" ]; then
    CXXFLAGS="-fPIC -Wall"
fi

echo -n "" > Makefile
echo "CC=$CC" >> Makefile
echo "CFLAGS=$CFLAGS" >> Makefile
echo "CXX=$CXX" >> Makefile
echo "CXXFLAGS=$CXXFLAGS" >> Makefile
echo "PREFIX=$PREFIX" >> Makefile
echo "FLINT_DIR=$FLINT_DIR" >> Makefile
echo "SINGULAR_DIR=$SINGULAR_DIR" >> Makefile
echo "" >> Makefile

cat Makefile.in >> Makefile
